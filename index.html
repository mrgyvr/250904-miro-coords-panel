<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Coords Panel – Entrypoint (Debug)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      /* purely for a friendly message if opened outside Miro */
      body { margin: 0; font: 14px/1.5 system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
      #hint { padding: 16px; }
    </style>
  </head>
  <body>
    <div id="hint"></div>

    <script type="module">
      const hint = document.getElementById('hint');
      const show = (html) => { hint.innerHTML = html; };

      // Cache-busted panel URL so updates to panel.html show immediately
      const PANEL_URL = `panel.html?v=${Date.now()}`;

      if (!('miro' in window)) {
        // Hosted correctly but opened outside a Miro board
        show('<b>This page is meant to run inside a Miro board.</b><br>Open a board in the team where the app is installed.');
      } else {
        try {
          // Optional: wait for SDK readiness if available
          if (typeof miro.onReady === 'function') {
            await miro.onReady();
          }

          // Register toolbar icon click → open panel (also uses cache-busted URL)
          miro.board.ui.on('icon:click', () => {
            miro.board.ui.openPanel({ url: PANEL_URL }).catch(() => {});
          });

          // TEMP: auto-open the panel so you can see it immediately while debugging
          await miro.board.ui.openPanel({ url: PANEL_URL });

          // Tip: once you confirm it opens, remove the auto-open line above.
        } catch (e) {
          show(`<div style="color:#b00020;">Failed to open panel: ${e?.message || e}</div>`);
        }
      }
    </script>
  </body>
</html>
